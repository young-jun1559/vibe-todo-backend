<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App - Heroku ì—°ë™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 100%;
            max-width: 800px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .api-status {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: #ccc;
        }
        
        .status-indicator.connected {
            background-color: #4caf50;
        }
        
        .status-indicator.disconnected {
            background-color: #f44336;
        }
        
        .todo-form {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .todo-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .todo-input:focus {
            border-color: #667eea;
        }
        
        .priority-select {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            min-width: 120px;
        }
        
        .add-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .todo-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .todo-item {
            background: #f8f9ff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .todo-item:hover {
            transform: translateX(5px);
        }
        
        .todo-content {
            flex: 1;
        }
        
        .todo-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .todo-description {
            color: #666;
            margin-bottom: 10px;
        }
        
        .todo-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #888;
        }
        
        .priority {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .priority.high {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .priority.medium {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .priority.low {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        .todo-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        .btn-edit {
            background-color: #2196f3;
            color: white;
        }
        
        .btn-delete {
            background-color: #f44336;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .todo-form {
                flex-direction: column;
            }
            
            .todo-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .todo-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Todo App</h1>
            <p>Heroku ë°±ì—”ë“œì™€ ì—°ë™ëœ í• ì¼ ê´€ë¦¬ ì•±</p>
        </div>
        
        <div class="api-status">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">API ì—°ê²° í™•ì¸ ì¤‘...</span>
        </div>
        
        <div id="messageContainer"></div>
        
        <form class="todo-form" id="todoForm">
            <input type="text" class="todo-input" id="todoTitle" placeholder="í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." required>
            <input type="text" class="todo-input" id="todoDescription" placeholder="ì„¤ëª… (ì„ íƒì‚¬í•­)">
            <select class="priority-select" id="todoPriority">
                <option value="medium">ë³´í†µ</option>
                <option value="high">ë†’ìŒ</option>
                <option value="low">ë‚®ìŒ</option>
            </select>
            <button type="submit" class="add-btn">ì¶”ê°€</button>
        </form>
        
        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ì „ì²´ í• ì¼</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="highCount">0</div>
                <div class="stat-label">ë†’ì€ ìš°ì„ ìˆœìœ„</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mediumCount">0</div>
                <div class="stat-label">ë³´í†µ ìš°ì„ ìˆœìœ„</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="lowCount">0</div>
                <div class="stat-label">ë‚®ì€ ìš°ì„ ìˆœìœ„</div>
            </div>
        </div>
        
        <div id="todoList" class="todo-list">
            <div class="loading">í• ì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <script>
        // API URL ì„¤ì •
        // ë¡œì»¬ ê°œë°œ í™˜ê²½(localhost:3333)ì—ì„œëŠ” Heroku ë°±ì—”ë“œ ì‚¬ìš©
        // ë‹¤ë¥¸ í™˜ê²½ì—ì„œëŠ” ìë™ìœ¼ë¡œ ì ì ˆí•œ API URL ì„ íƒ
        const getApiBaseUrl = () => {
            const hostname = window.location.hostname;

            // ë¡œì»¬ ê°œë°œ í™˜ê²½
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                // ë¡œì»¬ì—ì„œëŠ” Heroku ë°±ì—”ë“œ ì‚¬ìš©
                return 'https://vibe-todo-backend-app-2356eab77040.herokuapp.com/api';
            }

            // Herokuì— ë°°í¬ëœ ê²½ìš° (ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œê°€ ê°™ì€ ì„œë²„)
            if (hostname.includes('herokuapp.com')) {
                return `${window.location.origin}/api`;
            }

            // ê¸°ë³¸ê°’: Heroku ë°±ì—”ë“œ
            return 'https://vibe-todo-backend-app-2356eab77040.herokuapp.com/api';
        };

        const API_BASE_URL = getApiBaseUrl();
        console.log('ğŸ”§ API Base URL:', API_BASE_URL);

        // DOM ìš”ì†Œë“¤
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const messageContainer = document.getElementById('messageContainer');
        const todoForm = document.getElementById('todoForm');
        const todoList = document.getElementById('todoList');
        const totalCount = document.getElementById('totalCount');
        const highCount = document.getElementById('highCount');
        const mediumCount = document.getElementById('mediumCount');
        const lowCount = document.getElementById('lowCount');
        
        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(message, type = 'success') {
            messageContainer.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 3000);
        }
        
        // API ì—°ê²° ìƒíƒœ í™•ì¸
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                if (response.ok) {
                    statusIndicator.className = 'status-indicator connected';
                    statusText.textContent = 'Heroku API ì—°ê²°ë¨';
                    return true;
                } else {
                    throw new Error('API ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (error) {
                statusIndicator.className = 'status-indicator disconnected';
                statusText.textContent = 'Heroku API ì—°ê²° ì‹¤íŒ¨';
                showMessage('Heroku APIì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }
        }
        
        // í• ì¼ ëª©ë¡ ì¡°íšŒ
        async function fetchTodos() {
            try {
                const response = await fetch(`${API_BASE_URL}/todos`);
                const data = await response.json();
                
                if (data.success) {
                    renderTodos(data.data);
                    updateStats(data.data);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                todoList.innerHTML = `<div class="error">í• ì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${error.message}</div>`;
            }
        }
        
        // í• ì¼ ëª©ë¡ ë Œë”ë§
        function renderTodos(todos) {
            if (todos.length === 0) {
                todoList.innerHTML = '<div class="loading">ë“±ë¡ëœ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í• ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>';
                return;
            }
            
            todoList.innerHTML = todos.map(todo => `
                <div class="todo-item">
                    <div class="todo-content">
                        <div class="todo-title">${todo.title}</div>
                        ${todo.description ? `<div class="todo-description">${todo.description}</div>` : ''}
                        <div class="todo-meta">
                            <span class="priority ${todo.priority}">${getPriorityText(todo.priority)}</span>
                            <span>ìƒì„±ì¼: ${new Date(todo.createdAt).toLocaleDateString('ko-KR')}</span>
                            ${todo.dueDate ? `<span>ë§ˆê°ì¼: ${new Date(todo.dueDate).toLocaleDateString('ko-KR')}</span>` : ''}
                        </div>
                    </div>
                    <div class="todo-actions">
                        <button class="btn btn-edit" onclick="editTodo('${todo._id}')">ìˆ˜ì •</button>
                        <button class="btn btn-delete" onclick="deleteTodo('${todo._id}')">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ìš°ì„ ìˆœìœ„ í…ìŠ¤íŠ¸ ë³€í™˜
        function getPriorityText(priority) {
            const priorityMap = {
                high: 'ë†’ìŒ',
                medium: 'ë³´í†µ',
                low: 'ë‚®ìŒ'
            };
            return priorityMap[priority] || priority;
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(todos) {
            totalCount.textContent = todos.length;
            highCount.textContent = todos.filter(todo => todo.priority === 'high').length;
            mediumCount.textContent = todos.filter(todo => todo.priority === 'medium').length;
            lowCount.textContent = todos.filter(todo => todo.priority === 'low').length;
        }
        
        // í• ì¼ ì¶”ê°€
        async function addTodo(todoData) {
            try {
                const response = await fetch(`${API_BASE_URL}/todos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(todoData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('í• ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    fetchTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    todoForm.reset(); // í¼ ì´ˆê¸°í™”
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                showMessage(`í• ì¼ ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // í• ì¼ ì‚­ì œ
        async function deleteTodo(id) {
            if (!confirm('ì •ë§ë¡œ ì´ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/todos/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('í• ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    fetchTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                showMessage(`í• ì¼ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // í• ì¼ ìˆ˜ì • (ê°„ë‹¨í•œ ì œëª© ë³€ê²½)
        async function editTodo(id) {
            const newTitle = prompt('ìƒˆë¡œìš´ í• ì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!newTitle || newTitle.trim() === '') {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/todos/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title: newTitle.trim() })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('í• ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    fetchTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                showMessage(`í• ì¼ ìˆ˜ì • ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // í¼ ì œì¶œ ì´ë²¤íŠ¸
        todoForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const title = document.getElementById('todoTitle').value.trim();
            const description = document.getElementById('todoDescription').value.trim();
            const priority = document.getElementById('todoPriority').value;
            
            if (!title) {
                showMessage('í• ì¼ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const todoData = {
                title,
                priority
            };
            
            if (description) {
                todoData.description = description;
            }
            
            addTodo(todoData);
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            const isApiConnected = await checkApiStatus();
            if (isApiConnected) {
                fetchTodos();
            }
        });
        
        // 5ì´ˆë§ˆë‹¤ API ìƒíƒœ í™•ì¸
        setInterval(checkApiStatus, 5000);
    </script>
</body>
</html>